<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompt Builder</title>
  <style>
    :root { --bg:#0f1115; --card:#151925; --text:#e8eaf0; --muted:#aab0c0; --line:#252b3b; }
    *{ box-sizing:border-box; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial; }
    body{ margin:0; background:linear-gradient(180deg,#0f1115,#0b0d12); color:var(--text); }
    .wrap{ max-width:980px; margin:0 auto; padding:28px 16px 60px; }
    h1{ margin:0 0 6px; font-size:26px; }
    .sub{ margin:0 0 18px; color:var(--muted); }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width:820px){ .row{ grid-template-columns:1fr; } }
    .card{ background:rgba(21,25,37,.9); border:1px solid var(--line); border-radius:16px; padding:14px; }
    label{ display:block; font-size:12px; color:var(--muted); margin:6px 0 8px; }
    textarea, input{
      width:100%; background:#0f1320; color:var(--text);
      border:1px solid var(--line); border-radius:12px; padding:12px;
      outline:none;
    }
    textarea{ min-height:110px; resize:vertical; }
    .toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin:14px 0; }
    .left, .right{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    button{
      background:#2c6cff; color:white; border:0; border-radius:12px;
      padding:10px 12px; cursor:pointer; font-weight:700;
    }
    button.secondary{ background:#22283a; color:var(--text); border:1px solid var(--line); font-weight:600; }
    .pill{ display:flex; gap:8px; align-items:center; padding:8px 10px; border:1px solid var(--line); border-radius:999px; background:#121728; color:var(--muted); }
    select{ background:#121728; color:var(--text); border:1px solid var(--line); border-radius:10px; padding:8px 10px; }
    .out{ min-height:170px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .hint{ color:var(--muted); font-size:12px; margin-top:8px; line-height:1.5; }
    .ok{ color:#6dff9a; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Prompt Builder</h1>
    <p class="sub">공식: <b>[기법&주제] + [배경&블렌딩] + [조명&색감] + [디테일&분위기] + [규격]</b></p>

    <div class="row">
      <div class="card">
        <label>1) 기법 & 주제</label>
        <textarea id="t1" placeholder="예: double exposure portrait of a young woman, side profile"></textarea>

        <label>2) 배경 & 블렌딩 요소</label>
        <textarea id="t2" placeholder="예: blended with NYC skyline including Empire State Building, hair merges with skyscrapers"></textarea>

        <label>3) 조명 & 색감</label>
        <textarea id="t3" placeholder="예: warm golden hour, amber/honey gold/peach tones, high contrast"></textarea>

        <label>4) 디테일 & 분위기</label>
        <textarea id="t4" placeholder="예: cross-processed film look, vintage grain, peaceful expression, Instagram aesthetic"></textarea>

        <label>5) 규격</label>
        <input id="t5" placeholder="예: aspect ratio 3:4 vertical portrait, ultra-clean background" />
      </div>

      <div class="card">
        <div class="toolbar">
          <div class="left">
            <div class="pill">
              언어
              <select id="lang">
                <option value="en" selected>English</option>
                <option value="ko">Korean</option>
              </select>
            </div>
            <div class="pill">
              포맷
              <select id="format">
                <option value="one" selected>한 줄(합치기)</option>
                <option value="block">블록(섹션 유지)</option>
              </select>
            </div>
          </div>
          <div class="right">
            <button class="secondary" id="clearBtn">비우기</button>
            <button id="copyBtn">복사</button>
            <button class="secondary" id="aiBtn">AI 자동 생성</button>    
            
          </div>
        </div>

      
        <label>완성 프롬프트</label>
        <textarea id="out" class="out" placeholder="여기에 결과가 생성됩니다" readonly></textarea>
        <div class="hint" id="status"></div>
        <div class="hint">
          팁: 모델마다 규격 표현이 달라도 괜찮아. (예: “--ar 3:4” / “aspect ratio 3:4”)<br/>
          다음 버전으로 템플릿 저장/불러오기, 프리셋(MJ/Veo/SD)도 쉽게 추가 가능.
        </div>
      </div>
    </div>
  </div>

  <script>
  const els = {
    t1: document.getElementById('t1'),
    t2: document.getElementById('t2'),
    t3: document.getElementById('t3'),
    t4: document.getElementById('t4'),
    t5: document.getElementById('t5'),
    out: document.getElementById('out'),
    lang: document.getElementById('lang'),
    format: document.getElementById('format'),
    status: document.getElementById('status'),
    copyBtn: document.getElementById('copyBtn'),
    clearBtn: document.getElementById('clearBtn'),
    aiBtn: document.getElementById('aiBtn'),
  };

  const i18n = {
    en: {
      labels: ["[Technique & Subject]", "[Background & Blending]", "[Lighting & Color]", "[Details & Mood]", "[Specs]"],
      copied: "✅ Copied to clipboard!",
      empty: "입력하면 자동으로 생성돼요.",
    },
    ko: {
      labels: ["[기법 & 주제]", "[배경 & 블렌딩 요소]", "[조명 & 색감]", "[디테일 & 분위기]", "[규격]"],
      copied: "✅ 클립보드에 복사했어요!",
      empty: "입력하면 자동으로 생성돼요.",
    }
  };

  function clean(s){ return (s||"").trim().replace(/\s+/g,' '); }

  function build(){
    const L = i18n[els.lang.value];
    const parts = [clean(els.t1.value), clean(els.t2.value), clean(els.t3.value), clean(els.t4.value), clean(els.t5.value)];

    if(parts.every(p => !p)){
      els.out.value = "";
      els.status.textContent = L.empty;
      return;
    }

    if(els.format.value === "one"){
      const line = parts.filter(Boolean).join(", ");
      els.out.value = line;
    } else {
      const block = parts.map((p,i)=> p ? `${L.labels[i]}: ${p}` : `${L.labels[i]}:`).join("\n\n");
      els.out.value = block.trim();
    }
    els.status.textContent = "";
  }

  ["input","change"].forEach(evt=>{
    [els.t1,els.t2,els.t3,els.t4,els.t5,els.lang,els.format].forEach(el=> el.addEventListener(evt, build));
  });

  els.copyBtn.addEventListener('click', async ()=>{
    if(!els.out.value.trim()) return;
    try{
      await navigator.clipboard.writeText(els.out.value);
      els.status.innerHTML = `<span class="ok">${i18n[els.lang.value].copied}</span>`;
      setTimeout(()=> els.status.textContent="", 1400);
    } catch(e){
      els.out.select();
      document.execCommand('copy');
      els.status.innerHTML = `<span class="ok">${i18n[els.lang.value].copied}</span>`;
      setTimeout(()=> els.status.textContent="", 1400);
    }
  });

  els.clearBtn.addEventListener('click', ()=>{
    [els.t1,els.t2,els.t3,els.t4].forEach(el=> el.value="");
    els.t5.value="";
    build();
  });

  // ✅ AI 자동 생성 (반드시 script 안에 있어야 함)
  els.aiBtn.addEventListener('click', async ()=>{
    const payload = {
      t1: els.t1.value, t2: els.t2.value, t3: els.t3.value, t4: els.t4.value, t5: els.t5.value,
      lang: els.lang.value,
      format: els.format.value === "one" ? "one" : "block"
    };

    els.status.textContent = "AI 생성 중...";
    try{
      const r = await fetch("/api/generate", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const data = await r.json();
      if(!r.ok) throw new Error(data?.detail || data?.error || "Request failed");
      els.out.value = (data.text || "").trim();
      els.status.innerHTML = `<span class="ok">✅ AI로 생성 완료!</span>`;
      setTimeout(()=> els.status.textContent="", 1400);
    }catch(e){
      els.status.textContent = "에러: " + e.message;
    }
  });

  build();
</script>

</body>
</html>
